<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì—É–º—ë—à–∫–∏ - –ò–≥—Ä–∞-—Ö–æ–¥–∏–ª–∫–∞ –Ω–∞ –¥–≤–æ–∏—Ö</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Russo+One&family=Roboto:wght@400;700&display=swap');
        
        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, #0d2818 0%, #1a4d2e 50%, #2d6a4f 100%);
            min-height: 100vh;
        }
        
        .title-font {
            font-family: 'Russo One', sans-serif;
        }
        
        .malachite-bg {
            background: linear-gradient(145deg, #2d6a4f, #40916c, #1b4332, #52b788);
            background-size: 400% 400%;
            animation: malachite-flow 8s ease infinite;
        }
        
        @keyframes malachite-flow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .cell {
            transition: all 0.3s ease;
            font-size: 0.65rem;
        }
        
        .cell:hover {
            transform: scale(1.08);
            z-index: 10;
        }
        
        .cell.question-cell-1 {
            background: linear-gradient(145deg, #3b82f6, #1d4ed8, #60a5fa);
            animation: pulse-blue 2s infinite;
        }
        
        .cell.question-cell-2 {
            background: linear-gradient(145deg, #eab308, #ca8a04, #facc15);
            animation: pulse-yellow 2s infinite;
        }
        
        .cell.question-cell-3 {
            background: linear-gradient(145deg, #ef4444, #b91c1c, #f87171);
            animation: pulse-red 2s infinite;
        }
        
        .cell.bonus-cell {
            background: linear-gradient(145deg, #10b981, #059669, #34d399);
            animation: pulse-green 2s infinite;
        }
        
        .cell.penalty-cell {
            background: linear-gradient(145deg, #8b5cf6, #7c3aed, #a78bfa);
            animation: pulse-purple 2s infinite;
        }
        
        @keyframes pulse-blue {
            0%, 100% { box-shadow: 0 0 3px rgba(59, 130, 246, 0.5); }
            50% { box-shadow: 0 0 10px rgba(59, 130, 246, 0.9), 0 0 15px rgba(29, 78, 216, 0.5); }
        }
        
        @keyframes pulse-yellow {
            0%, 100% { box-shadow: 0 0 3px rgba(234, 179, 8, 0.5); }
            50% { box-shadow: 0 0 10px rgba(234, 179, 8, 0.9), 0 0 15px rgba(202, 138, 4, 0.5); }
        }
        
        @keyframes pulse-red {
            0%, 100% { box-shadow: 0 0 3px rgba(239, 68, 68, 0.5); }
            50% { box-shadow: 0 0 10px rgba(239, 68, 68, 0.9), 0 0 15px rgba(185, 28, 28, 0.5); }
        }
        
        @keyframes pulse-green {
            0%, 100% { box-shadow: 0 0 3px rgba(16, 185, 129, 0.5); }
            50% { box-shadow: 0 0 10px rgba(16, 185, 129, 0.9), 0 0 15px rgba(5, 150, 105, 0.5); }
        }
        
        @keyframes pulse-purple {
            0%, 100% { box-shadow: 0 0 3px rgba(139, 92, 246, 0.5); }
            50% { box-shadow: 0 0 10px rgba(139, 92, 246, 0.9), 0 0 15px rgba(124, 58, 237, 0.5); }
        }
        
        .player {
            filter: drop-shadow(0 0 4px rgba(255, 255, 255, 0.8));
            font-size: 0.9rem;
            position: absolute;
            transition: all 0.3s ease;
        }
        
        .player-1 {
            animation: bounce1 0.5s ease infinite alternate;
            top: -2px;
            left: 2px;
        }
        
        .player-2 {
            animation: bounce2 0.5s ease infinite alternate;
            bottom: -2px;
            right: 2px;
        }
        
        @keyframes bounce1 {
            from { transform: translateY(0); }
            to { transform: translateY(-3px); }
        }
        
        @keyframes bounce2 {
            from { transform: translateY(0); }
            to { transform: translateY(-3px); }
        }
        
        .dice {
            transition: transform 0.3s ease;
        }
        
        .dice:hover {
            transform: scale(1.1);
        }
        
        .dice.rolling {
            animation: roll 0.5s ease-in-out;
        }
        
        @keyframes roll {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.2); }
            100% { transform: rotate(360deg) scale(1); }
        }
        
        .modal {
            backdrop-filter: blur(5px);
        }
        
        .level-badge {
            font-size: 0.7rem;
            padding: 3px 8px;
            border-radius: 10px;
        }
        
        .gem-icon {
            animation: sparkle 1.5s ease-in-out infinite;
        }
        
        @keyframes sparkle {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.3) drop-shadow(0 0 5px rgba(82, 183, 136, 0.8)); }
        }
        
        .active-player {
            animation: glow 1s ease-in-out infinite;
        }
        
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 5px currentColor; }
            50% { box-shadow: 0 0 20px currentColor, 0 0 30px currentColor; }
        }

        /* Tool selection */
        .tool-card {
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .tool-card:hover {
            transform: translateY(-4px) scale(1.03);
            box-shadow: 0 8px 25px rgba(0,0,0,0.4);
        }
        
        .tool-card.selected {
            border-color: #fbbf24 !important;
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.6), 0 0 40px rgba(251, 191, 36, 0.3);
            transform: scale(1.05);
        }
        
        .tool-card.selected::after {
            content: '‚úî';
            position: absolute;
            top: 4px;
            right: 6px;
            background: #fbbf24;
            color: #000;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
        
        .tool-card.disabled {
            opacity: 0.3;
            pointer-events: none;
            filter: grayscale(1);
        }
        
        .tool-icon-big {
            font-size: 2.5rem;
            animation: float 2s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-6px); }
        }
        
        .tool-card:nth-child(2) .tool-icon-big { animation-delay: 0.2s; }
        .tool-card:nth-child(3) .tool-icon-big { animation-delay: 0.4s; }
        .tool-card:nth-child(4) .tool-icon-big { animation-delay: 0.6s; }
        .tool-card:nth-child(5) .tool-icon-big { animation-delay: 0.8s; }
        .tool-card:nth-child(6) .tool-icon-big { animation-delay: 1.0s; }
        .tool-card:nth-child(7) .tool-icon-big { animation-delay: 1.2s; }
        .tool-card:nth-child(8) .tool-icon-big { animation-delay: 1.4s; }

        .step-indicator {
            transition: all 0.5s ease;
        }
        
        .step-indicator.active {
            background: #fbbf24;
            color: #000;
            transform: scale(1.2);
        }
        
        .selection-glow {
            animation: selectionPulse 2s ease-in-out infinite;
        }
        
        @keyframes selectionPulse {
            0%, 100% { text-shadow: 0 0 10px rgba(251, 191, 36, 0.5); }
            50% { text-shadow: 0 0 25px rgba(251, 191, 36, 1), 0 0 40px rgba(251, 191, 36, 0.5); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="p-2 md:p-3">
    
    <!-- ============ –≠–ö–†–ê–ù –í–´–ë–û–†–ê –ü–ï–†–°–û–ù–ê–ñ–ï–ô ============ -->
    <div id="selectionScreen" class="max-w-3xl mx-auto">
        <header class="text-center mb-4 pt-4">
            <h1 class="title-font text-3xl md:text-5xl text-emerald-400 mb-2">
                <span class="gem-icon">üíé</span> –ì—É–º—ë—à–∫–∏ <span class="gem-icon">üíé</span>
            </h1>
            <p class="text-emerald-200 text-sm md:text-lg mb-3">–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –ø–æ –ú–µ–¥–Ω–æ–π –≥–æ—Ä–µ</p>
            <div class="flex justify-center gap-3 mb-4">
                <div id="step1Dot" class="step-indicator active w-8 h-8 rounded-full bg-amber-400 text-black flex items-center justify-center font-bold text-sm">1</div>
                <div class="flex items-center text-gray-500">‚îÄ‚îÄ‚îÄ</div>
                <div id="step2Dot" class="step-indicator w-8 h-8 rounded-full bg-gray-600 text-gray-300 flex items-center justify-center font-bold text-sm">2</div>
            </div>
        </header>

        <!-- –®–∞–≥ 1: –í—ã–±–æ—Ä –∏–≥—Ä–æ–∫–∞ 1 -->
        <div id="selectionStep1" class="fade-in">
            <div class="text-center mb-4">
                <h2 class="title-font text-xl md:text-2xl text-amber-400 selection-glow">‚õèÔ∏è –ò–≥—Ä–æ–∫ 1 ‚Äî –≤—ã–±–µ—Ä–∏ –æ—Ä—É–¥–∏–µ —Ç—Ä—É–¥–∞</h2>
                <p class="text-emerald-200 text-xs mt-1">–í—ã–±–µ—Ä–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, —Å –∫–æ—Ç–æ—Ä—ã–º –æ—Ç–ø—Ä–∞–≤–∏—à—å—Å—è –≤ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –ø–æ –ú–µ–¥–Ω–æ–π –≥–æ—Ä–µ</p>
            </div>
            <div id="toolsGrid1" class="grid grid-cols-2 sm:grid-cols-4 gap-3 mb-4">
                <!-- Generated by JS -->
            </div>
            <div class="text-center">
                <button id="confirmPlayer1" disabled class="bg-gray-600 text-gray-400 font-bold py-2.5 px-8 rounded-xl text-base cursor-not-allowed transition border-2 border-gray-500">
                    –î–∞–ª–µ–µ ‚Üí
                </button>
            </div>
        </div>

        <!-- –®–∞–≥ 2: –í—ã–±–æ—Ä –∏–≥—Ä–æ–∫–∞ 2 -->
        <div id="selectionStep2" class="hidden fade-in">
            <div class="text-center mb-4">
                <h2 class="title-font text-xl md:text-2xl text-cyan-400 selection-glow">üî® –ò–≥—Ä–æ–∫ 2 ‚Äî –≤—ã–±–µ—Ä–∏ –æ—Ä—É–¥–∏–µ —Ç—Ä—É–¥–∞</h2>
                <p class="text-emerald-200 text-xs mt-1">–í—ã–±–µ—Ä–∏ —Å–≤–æ–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç (—É–∂–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã)</p>
            </div>
            <div id="toolsGrid2" class="grid grid-cols-2 sm:grid-cols-4 gap-3 mb-4">
                <!-- Generated by JS -->
            </div>
            <div class="text-center flex justify-center gap-3">
                <button id="backToPlayer1" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2.5 px-6 rounded-xl text-sm transition border-2 border-gray-500">
                    ‚Üê –ù–∞–∑–∞–¥
                </button>
                <button id="startGameBtn" disabled class="bg-gray-600 text-gray-400 font-bold py-2.5 px-8 rounded-xl text-base cursor-not-allowed transition border-2 border-gray-500">
                    ‚öîÔ∏è –ù–∞—á–∞—Ç—å –∏–≥—Ä—É!
                </button>
            </div>
        </div>

        <!-- Preview –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö -->
        <div id="selectionPreview" class="mt-4 bg-black/30 rounded-xl p-3">
            <div class="grid grid-cols-2 gap-3">
                <div class="text-center">
                    <p class="text-amber-300 font-bold text-xs mb-1">–ò–≥—Ä–æ–∫ 1</p>
                    <div id="preview1" class="text-3xl">‚ùì</div>
                    <p id="preview1Name" class="text-gray-400 text-xs mt-1">–ù–µ –≤—ã–±—Ä–∞–Ω–æ</p>
                </div>
                <div class="text-center">
                    <p class="text-cyan-300 font-bold text-xs mb-1">–ò–≥—Ä–æ–∫ 2</p>
                    <div id="preview2" class="text-3xl">‚ùì</div>
                    <p id="preview2Name" class="text-gray-400 text-xs mt-1">–ù–µ –≤—ã–±—Ä–∞–Ω–æ</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ============ –ò–ì–†–û–í–û–ô –≠–ö–†–ê–ù ============ -->
    <div id="gameScreen" class="max-w-6xl mx-auto hidden">
        <!-- Header -->
        <header class="text-center mb-3">
            <h1 class="title-font text-2xl md:text-4xl text-emerald-400 mb-1">
                <span class="gem-icon">üíé</span> –ì—É–º—ë—à–∫–∏ <span class="gem-icon">üíé</span>
            </h1>
            <p class="text-emerald-200 text-sm md:text-base">–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –ø–æ –ú–µ–¥–Ω–æ–π –≥–æ—Ä–µ</p>
        </header>

        <!-- Players Stats -->
        <div class="grid grid-cols-2 gap-2 mb-3">
            <!-- Player 1 -->
            <div id="player1Card" class="bg-gradient-to-r from-amber-600 to-orange-700 p-2 rounded-xl shadow-lg border-2 border-amber-400 active-player">
                <div class="flex items-center gap-2 mb-1">
                    <span class="text-xl" id="p1Icon">‚õèÔ∏è</span>
                    <div>
                        <span class="text-white font-bold text-sm" id="p1CardName">–ò–≥—Ä–æ–∫ 1</span>
                        <span class="text-amber-200 text-xs block" id="p1CardTool">–ö–∏—Ä–∫–∞</span>
                    </div>
                </div>
                <div class="grid grid-cols-3 gap-1 text-xs">
                    <div class="bg-black/30 rounded p-1 text-center">
                        <div class="text-amber-200">–®–∞–≥</div>
                        <div class="text-white font-bold"><span id="player1Position">1</span>/50</div>
                    </div>
                    <div class="bg-black/30 rounded p-1 text-center">
                        <div class="text-green-300">‚úÖ</div>
                        <div class="text-white font-bold" id="player1Correct">0</div>
                    </div>
                    <div class="bg-black/30 rounded p-1 text-center">
                        <div class="text-red-300">‚ùå</div>
                        <div class="text-white font-bold" id="player1Wrong">0</div>
                    </div>
                </div>
            </div>
            
            <!-- Player 2 -->
            <div id="player2Card" class="bg-gradient-to-r from-cyan-600 to-blue-700 p-2 rounded-xl shadow-lg border-2 border-cyan-400 opacity-60">
                <div class="flex items-center gap-2 mb-1">
                    <span class="text-xl" id="p2Icon">üî®</span>
                    <div>
                        <span class="text-white font-bold text-sm" id="p2CardName">–ò–≥—Ä–æ–∫ 2</span>
                        <span class="text-cyan-200 text-xs block" id="p2CardTool">–ú–æ–ª–æ—Ç–æ–∫</span>
                    </div>
                </div>
                <div class="grid grid-cols-3 gap-1 text-xs">
                    <div class="bg-black/30 rounded p-1 text-center">
                        <div class="text-cyan-200">–®–∞–≥</div>
                        <div class="text-white font-bold"><span id="player2Position">1</span>/50</div>
                    </div>
                    <div class="bg-black/30 rounded p-1 text-center">
                        <div class="text-green-300">‚úÖ</div>
                        <div class="text-white font-bold" id="player2Correct">0</div>
                    </div>
                    <div class="bg-black/30 rounded p-1 text-center">
                        <div class="text-red-300">‚ùå</div>
                        <div class="text-white font-bold" id="player2Wrong">0</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Current Turn Indicator -->
        <div class="text-center mb-2">
            <span id="turnIndicator" class="bg-amber-500 text-gray-900 px-4 py-1 rounded-full font-bold text-sm">
                ‚õèÔ∏è –•–æ–¥ –∏–≥—Ä–æ–∫–∞ 1
            </span>
        </div>

        <!-- Game Board -->
        <div class="malachite-bg p-2 rounded-2xl shadow-2xl mb-3 border-2 border-emerald-600">
            <div id="gameBoard" class="grid grid-cols-10 gap-1">
            </div>
        </div>

        <!-- Controls -->
        <div class="flex flex-col items-center gap-2">
            <button id="rollDice" class="dice bg-gradient-to-r from-amber-500 to-orange-600 hover:from-amber-400 hover:to-orange-500 text-white font-bold py-2 px-5 rounded-xl text-base shadow-lg flex items-center gap-2 border-2 border-amber-400">
                üé≤ –ë—Ä–æ—Å–∏—Ç—å –∫—É–±–∏–∫
            </button>
            <div id="diceResult" class="text-white text-lg font-bold hidden">
                –í—ã–ø–∞–ª–æ: <span id="diceValue" class="text-amber-400">0</span>
            </div>
            <button id="restartGame" class="bg-gray-700 hover:bg-gray-600 text-white py-1.5 px-4 rounded-xl border border-gray-600 text-xs">
                üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ
            </button>
        </div>

        <!-- Legend -->
        <div class="mt-3 bg-black/30 p-2 rounded-xl">
            <h3 class="text-center text-emerald-300 font-bold mb-2 text-xs">–õ–µ–≥–µ–Ω–¥–∞</h3>
            <div class="flex flex-wrap justify-center gap-2 text-xs">
                <div class="flex items-center gap-1 text-gray-300">
                    <div class="w-4 h-4 bg-gradient-to-r from-blue-500 to-blue-700 rounded border border-blue-400"></div>
                    <span>–ù–æ–≤–∏—á–æ–∫</span>
                </div>
                <div class="flex items-center gap-1 text-gray-300">
                    <div class="w-4 h-4 bg-gradient-to-r from-yellow-500 to-yellow-700 rounded border border-yellow-400"></div>
                    <span>–ó–Ω–∞—Ç–æ–∫</span>
                </div>
                <div class="flex items-center gap-1 text-gray-300">
                    <div class="w-4 h-4 bg-gradient-to-r from-red-500 to-red-700 rounded border border-red-400"></div>
                    <span>–≠–∫—Å–ø–µ—Ä—Ç</span>
                </div>
                <div class="flex items-center gap-1 text-gray-300">
                    <div class="w-4 h-4 bg-gradient-to-r from-green-500 to-green-700 rounded border border-green-400"></div>
                    <span>üçÄ +3</span>
                </div>
                <div class="flex items-center gap-1 text-gray-300">
                    <div class="w-4 h-4 bg-gradient-to-r from-purple-500 to-purple-700 rounded border border-purple-400"></div>
                    <span>üï≥Ô∏è -3</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Question Modal -->
    <div id="questionModal" class="modal fixed inset-0 bg-black/80 hidden items-center justify-center z-50 p-4">
        <div class="bg-gradient-to-br from-gray-900 via-emerald-950 to-gray-900 rounded-2xl p-4 max-w-lg w-full shadow-2xl border-2 border-emerald-600 max-h-[90vh] overflow-auto">
            <div class="text-center mb-2">
                <span class="text-2xl gem-icon">üíé</span>
                <h2 class="title-font text-lg text-emerald-400 mt-1">–ú–∞–ª–∞—Ö–∏—Ç–æ–≤–∞—è —à–∫–∞—Ç—É–ª–∫–∞</h2>
                <div class="flex justify-center gap-2 mt-1">
                    <span id="currentPlayerBadge" class="level-badge bg-amber-600 text-white">–ò–≥—Ä–æ–∫ 1</span>
                    <span id="levelBadge" class="level-badge bg-blue-600 text-white">–ù–æ–≤–∏—á–æ–∫</span>
                </div>
            </div>
            <p id="questionText" class="text-white text-sm mb-3 text-center leading-relaxed"></p>
            <div id="answersContainer" class="grid gap-2">
            </div>
            <div id="resultMessage" class="hidden mt-3 p-2 rounded-xl text-center text-sm font-bold"></div>
        </div>
    </div>

    <!-- Bonus/Penalty Modal -->
    <div id="bonusModal" class="modal fixed inset-0 bg-black/80 hidden items-center justify-center z-50 p-4">
        <div id="bonusModalContent" class="bg-gradient-to-br from-green-700 to-emerald-900 rounded-2xl p-5 max-w-sm w-full shadow-2xl text-center border-2 border-green-400">
            <div id="bonusIcon" class="text-5xl mb-3">üçÄ</div>
            <h2 id="bonusTitle" class="title-font text-xl text-white mb-2">–£–¥–∞—á–∞!</h2>
            <p id="bonusText" class="text-green-100 mb-4">–í—ã –Ω–∞—à–ª–∏ —Å–∞–º–æ—Ü–≤–µ—Ç! +3 –∫–ª–µ—Ç–∫–∏ –≤–ø–µ—Ä—ë–¥!</p>
        </div>
    </div>

    <!-- Win Modal -->
    <div id="winModal" class="modal fixed inset-0 bg-black/80 hidden items-center justify-center z-50 p-4">
        <div class="bg-gradient-to-br from-emerald-700 via-green-800 to-emerald-900 rounded-2xl p-5 max-w-md w-full shadow-2xl text-center border-2 border-emerald-400">
            <div class="text-5xl mb-3">üëë</div>
            <h2 class="title-font text-2xl text-emerald-200 mb-2">–ü–æ–±–µ–¥–∞!</h2>
            <p id="winnerText" class="text-emerald-100 text-lg mb-3"></p>
            <div class="bg-black/30 rounded-xl p-3 mb-4">
                <div class="grid grid-cols-2 gap-3 text-sm">
                    <div class="text-left">
                        <p id="finalP1Label" class="text-amber-300 font-bold mb-1">‚õèÔ∏è –ò–≥—Ä–æ–∫ 1</p>
                        <p class="text-emerald-200">‚úÖ <span id="final1Correct">0</span> | ‚ùå <span id="final1Wrong">0</span></p>
                    </div>
                    <div class="text-left">
                        <p id="finalP2Label" class="text-cyan-300 font-bold mb-1">üî® –ò–≥—Ä–æ–∫ 2</p>
                        <p class="text-emerald-200">‚úÖ <span id="final2Correct">0</span> | ‚ùå <span id="final2Wrong">0</span></p>
                    </div>
                </div>
            </div>
            <button id="playAgain" class="bg-amber-500 hover:bg-amber-400 text-gray-900 font-bold py-2 px-6 rounded-xl transition">
                üîÑ –ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞
            </button>
        </div>
    </div>

    <script>
        // ============ –û–†–£–î–ò–Ø –¢–†–£–î–ê ============
        const tools = [
            { id: 'pickaxe', icon: '‚õèÔ∏è', name: '–ö–∏—Ä–∫–∞', desc: '–í–µ—Ä–Ω–∞—è –ø–æ–¥—Ä—É–≥–∞ –≥–æ—Ä–Ω—è–∫–∞', bonus: '–ü—Ä–æ—á–Ω–∞—è –∏ –Ω–∞–¥—ë–∂–Ω–∞—è' },
            { id: 'hammer', icon: 'üî®', name: '–ú–æ–ª–æ—Ç–æ–∫', desc: '–î–ª—è —Ç–æ—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã', bonus: '–õ–æ–≤–∫–æ—Å—Ç—å –∏ —Å–∏–ª–∞' },
            { id: 'axe', icon: 'ü™ì', name: '–¢–æ–ø–æ—Ä', desc: '–ö—Ä–µ–ø–∏—Ç –∏ —Ä—É–±–∏—Ç', bonus: '–ú–æ—â—å –∏ —Ä–µ—à–∏–º–æ—Å—Ç—å' },
            { id: 'pick', icon: '‚öíÔ∏è', name: '–ö–∞–π–ª–æ', desc: '–î—Ä–æ–±–∏—Ç –ª—é–±—É—é –ø–æ—Ä–æ–¥—É', bonus: '–ù–µ—Å–æ–∫—Ä—É—à–∏–º—ã–π –¥—É—Ö' },
            { id: 'wrench', icon: 'üîß', name: '–ö–ª—é—á', desc: '–ú–∞—Å—Ç–µ—Ä –Ω–∞ –≤—Å–µ —Ä—É–∫–∏', bonus: '–°–º–µ–∫–∞–ª–∫–∞ –∏ —É–º' },
            { id: 'saw', icon: 'ü™ö', name: '–ü–∏–ª–∞', desc: '–ü–∏–ª–∏—Ç —Å–∫–≤–æ–∑—å –∫–∞–º–µ–Ω—å', bonus: '–¢–µ—Ä–ø–µ–Ω–∏–µ –∏ —Ç—Ä—É–¥' },
            { id: 'chisel', icon: 'üó°Ô∏è', name: '–ó—É–±–∏–ª–æ', desc: '–†–µ–∑–µ—Ü –∫–∞–º–Ω–µ—Ä–µ–∑–∞', bonus: '–¢–æ—á–Ω–æ—Å—Ç—å –î–∞–Ω–∏–ª—ã' },
            { id: 'lantern', icon: 'ü™î', name: '–õ–∞–º–ø–∞–¥–∞', desc: '–°–≤–µ—Ç –≤–æ —Ç—å–º–µ —à–∞—Ö—Ç—ã', bonus: '–ü—É—Ç–µ–≤–æ–¥–Ω—ã–π –æ–≥–æ–Ω—å' },
            { id: 'shovel', icon: '‚öôÔ∏è', name: '–®–µ—Å—Ç–µ—Ä–Ω—è', desc: '–°–µ—Ä–¥—Ü–µ –º–µ—Ö–∞–Ω–∏–∑–º–∞', bonus: '–ó–∞–≤–æ–¥—Å–∫–∞—è —Å–∏–ª–∞' },
            { id: 'compass', icon: 'üß≠', name: '–ö–æ–º–ø–∞—Å', desc: '–ù–µ –¥–∞—Å—Ç –∑–∞–±–ª—É–¥–∏—Ç—å—Å—è', bonus: '–í–µ—Ä–Ω—ã–π –ø—É—Ç—å' },
        ];

        let selectedTool1 = null;
        let selectedTool2 = null;

        // ============ –ì–ï–ù–ï–†–ê–¶–ò–Ø –ö–ê–†–¢–û–ß–ï–ö –ò–ù–°–¢–†–£–ú–ï–ù–¢–û–í ============
        function renderToolCards(gridId, playerNum) {
            const grid = document.getElementById(gridId);
            grid.innerHTML = '';
            
            tools.forEach(tool => {
                const card = document.createElement('div');
                const isDisabled = playerNum === 2 && selectedTool1 && selectedTool1.id === tool.id;
                
                card.className = `tool-card bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl p-3 border-2 border-gray-600 text-center ${isDisabled ? 'disabled' : ''}`;
                card.dataset.toolId = tool.id;
                
                if (playerNum === 1 && selectedTool1 && selectedTool1.id === tool.id) {
                    card.classList.add('selected');
                }
                if (playerNum === 2 && selectedTool2 && selectedTool2.id === tool.id) {
                    card.classList.add('selected');
                }
                
                card.innerHTML = `
                    <div class="tool-icon-big mb-1">${tool.icon}</div>
                    <h3 class="text-white font-bold text-sm">${tool.name}</h3>
                    <p class="text-gray-400 text-xs mt-1">${tool.desc}</p>
                    <p class="text-emerald-400 text-xs mt-1 italic">${tool.bonus}</p>
                `;
                
                if (!isDisabled) {
                    card.addEventListener('click', () => {
                        if (playerNum === 1) {
                            selectedTool1 = tool;
                            document.getElementById('preview1').textContent = tool.icon;
                            document.getElementById('preview1Name').textContent = tool.name;
                            document.getElementById('preview1Name').className = 'text-amber-300 text-xs mt-1 font-bold';
                            const btn = document.getElementById('confirmPlayer1');
                            btn.disabled = false;
                            btn.className = 'bg-gradient-to-r from-amber-500 to-orange-600 hover:from-amber-400 hover:to-orange-500 text-white font-bold py-2.5 px-8 rounded-xl text-base cursor-pointer transition border-2 border-amber-400 shadow-lg';
                        } else {
                            selectedTool2 = tool;
                            document.getElementById('preview2').textContent = tool.icon;
                            document.getElementById('preview2Name').textContent = tool.name;
                            document.getElementById('preview2Name').className = 'text-cyan-300 text-xs mt-1 font-bold';
                            const btn = document.getElementById('startGameBtn');
                            btn.disabled = false;
                            btn.className = 'bg-gradient-to-r from-emerald-500 to-green-600 hover:from-emerald-400 hover:to-green-500 text-white font-bold py-2.5 px-8 rounded-xl text-base cursor-pointer transition border-2 border-emerald-400 shadow-lg';
                        }
                        renderToolCards(gridId, playerNum);
                    });
                }
                
                grid.appendChild(card);
            });
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —ç–∫—Ä–∞–Ω–∞ –≤—ã–±–æ—Ä–∞
        renderToolCards('toolsGrid1', 1);

        // –ö–Ω–æ–ø–∫–∞ "–î–∞–ª–µ–µ" –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –ò–≥—Ä–æ–∫–∞ 1
        document.getElementById('confirmPlayer1').addEventListener('click', () => {
            if (!selectedTool1) return;
            document.getElementById('selectionStep1').classList.add('hidden');
            document.getElementById('selectionStep2').classList.remove('hidden');
            document.getElementById('selectionStep2').classList.add('fade-in');
            document.getElementById('step1Dot').classList.remove('active');
            document.getElementById('step1Dot').className = 'step-indicator w-8 h-8 rounded-full bg-green-500 text-white flex items-center justify-center font-bold text-sm';
            document.getElementById('step1Dot').textContent = '‚úì';
            document.getElementById('step2Dot').classList.add('active');
            renderToolCards('toolsGrid2', 2);
        });

        // –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" –∫ –≤—ã–±–æ—Ä—É –ò–≥—Ä–æ–∫–∞ 1
        document.getElementById('backToPlayer1').addEventListener('click', () => {
            document.getElementById('selectionStep2').classList.add('hidden');
            document.getElementById('selectionStep1').classList.remove('hidden');
            document.getElementById('step1Dot').className = 'step-indicator active w-8 h-8 rounded-full bg-amber-400 text-black flex items-center justify-center font-bold text-sm';
            document.getElementById('step1Dot').textContent = '1';
            document.getElementById('step2Dot').classList.remove('active');
            document.getElementById('step2Dot').className = 'step-indicator w-8 h-8 rounded-full bg-gray-600 text-gray-300 flex items-center justify-center font-bold text-sm';
            selectedTool2 = null;
            document.getElementById('preview2').textContent = '‚ùì';
            document.getElementById('preview2Name').textContent = '–ù–µ –≤—ã–±—Ä–∞–Ω–æ';
            document.getElementById('preview2Name').className = 'text-gray-400 text-xs mt-1';
            const btn = document.getElementById('startGameBtn');
            btn.disabled = true;
            btn.className = 'bg-gray-600 text-gray-400 font-bold py-2.5 px-8 rounded-xl text-base cursor-not-allowed transition border-2 border-gray-500';
            renderToolCards('toolsGrid1', 1);
        });

        // –ö–Ω–æ–ø–∫–∞ "–ù–∞—á–∞—Ç—å –∏–≥—Ä—É"
        document.getElementById('startGameBtn').addEventListener('click', () => {
            if (!selectedTool1 || !selectedTool2) return;
            document.getElementById('selectionScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
            document.getElementById('gameScreen').classList.add('fade-in');
            initGame();
        });


        // ============ –í–û–ü–†–û–°–´ ============
        const questions = [
            // –£–†–û–í–ï–ù–¨ 1: –ù–û–í–ò–ß–û–ö
            { level: 1, levelName: "–ù–æ–≤–∏—á–æ–∫", question: "–í –∫–∞–∫–æ–º –≥–æ—Ä–æ–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ì—É–º–µ—à–µ–≤—Å–∫–∏–π —Ä—É–¥–Ω–∏–∫?", answers: ["–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥", "–ù–∏–∂–Ω–∏–π –¢–∞–≥–∏–ª", "–ü–æ–ª–µ–≤—Å–∫–æ–π", "–ß–µ–ª—è–±–∏–Ω—Å–∫"], correct: 2 },
            { level: 1, levelName: "–ù–æ–≤–∏—á–æ–∫", question: "–ö–∞–∫–æ–π –ø–æ–ª—É–¥—Ä–∞–≥–æ—Ü–µ–Ω–Ω—ã–π –∫–∞–º–µ–Ω—å –ø—Ä–∏–Ω—ë—Å –º–∏—Ä–æ–≤—É—é —Å–ª–∞–≤—É –ì—É–º—ë—à–∫–∞–º?", answers: ["–ò–∑—É–º—Ä—É–¥", "–ú–∞–ª–∞—Ö–∏—Ç", "–Ø—à–º–∞", "–ê–ª–º–∞–∑"], correct: 1 },
            { level: 1, levelName: "–ù–æ–≤–∏—á–æ–∫", question: "–ö–∞–∫–æ–π –º–µ—Ç–∞–ª–ª –¥–æ–±—ã–≤–∞–ª–∏ –∏–∑ —Ä—É–¥—ã –ì—É–º–µ—à–µ–≤—Å–∫–æ–≥–æ –º–µ—Å—Ç–æ—Ä–æ–∂–¥–µ–Ω–∏—è?", answers: ["–ñ–µ–ª–µ–∑–æ", "–ó–æ–ª–æ—Ç–æ", "–ú–µ–¥—å", "–ê–ª—é–º–∏–Ω–∏–π"], correct: 2 },
            { level: 1, levelName: "–ù–æ–≤–∏—á–æ–∫", question: "–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –∑–Ω–∞–º–µ–Ω–∏—Ç—ã–π –ø–∏—Å–∞—Ç–µ–ª—å, –∫–æ—Ç–æ—Ä—ã–π –æ–ø–∏—Å–∞–ª –ì—É–º—ë—à–∫–∏ –≤ —Å–≤–æ–∏—Ö —Å–∫–∞–∑–∞—Ö?", answers: ["–î.–ù. –ú–∞–º–∏–Ω-–°–∏–±–∏—Ä—è–∫", "–ü.–ü. –ë–∞–∂–æ–≤", "–ê.–°. –ü—É—à–∫–∏–Ω", "–ù.–í. –ì–æ–≥–æ–ª—å"], correct: 1 },
            { level: 1, levelName: "–ù–æ–≤–∏—á–æ–∫", question: "–ö–∞–∫–æ–≥–æ —Ü–≤–µ—Ç–∞ –º–∞–ª–∞—Ö–∏—Ç?", answers: ["–ö—Ä–∞—Å–Ω—ã–π", "–°–∏–Ω–∏–π", "–ó–µ–ª—ë–Ω—ã–π", "–ñ—ë–ª—Ç—ã–π"], correct: 2 },
            { level: 1, levelName: "–ù–æ–≤–∏—á–æ–∫", question: "–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –≥–ª–∞–≤–Ω—ã–π –º–∏—Ñ–∏—á–µ—Å–∫–∏–π –ø–µ—Ä—Å–æ–Ω–∞–∂-—Ö—Ä–∞–Ω–∏—Ç–µ–ª—å–Ω–∏—Ü–∞ –≤ —Å–∫–∞–∑–∞—Ö –ë–∞–∂–æ–≤–∞?", answers: ["–°–Ω–µ–∂–Ω–∞—è –∫–æ—Ä–æ–ª–µ–≤–∞", "–•–æ–∑—è–π–∫–∞ –ú–µ–¥–Ω–æ–π –≥–æ—Ä—ã", "–ë–∞–±–∞-–Ø–≥–∞", "–í–∞—Å–∏–ª–∏—Å–∞ –ü—Ä–µ–º—É–¥—Ä–∞—è"], correct: 1 },
            { level: 1, levelName: "–ù–æ–≤–∏—á–æ–∫", question: "–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –∑–Ω–∞–º–µ–Ω–∏—Ç—ã–π —Å–±–æ—Ä–Ω–∏–∫ —Å–∫–∞–∑–æ–≤ –ü.–ü. –ë–∞–∂–æ–≤–∞?", answers: ["–ó–æ–ª–æ—Ç–∞—è —à–∫–∞—Ç—É–ª–∫–∞", "–ú–∞–ª–∞—Ö–∏—Ç–æ–≤–∞—è —à–∫–∞—Ç—É–ª–∫–∞", "–ò–∑—É–º—Ä—É–¥–Ω—ã–π –ª–∞—Ä–µ—Ü", "–ú–µ–¥–Ω—ã–π —Å—É–Ω–¥—É–∫"], correct: 1 },
            { level: 1, levelName: "–ù–æ–≤–∏—á–æ–∫", question: "–í –∫–∞–∫–æ–º –≤–µ–∫–µ –±—ã–ª –æ—Ç–∫—Ä—ã—Ç –ì—É–º–µ—à–µ–≤—Å–∫–∏–π —Ä—É–¥–Ω–∏–∫?", answers: ["XVI –≤–µ–∫", "XVII –≤–µ–∫", "XVIII –≤–µ–∫", "XIX –≤–µ–∫"], correct: 2 },
            { level: 1, levelName: "–ù–æ–≤–∏—á–æ–∫", question: "–ù–∞ –∫–∞–∫–æ–º –£—Ä–∞–ª–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –ì—É–º—ë—à–∫–∏?", answers: ["–°–µ–≤–µ—Ä–Ω—ã–π –£—Ä–∞–ª", "–°—Ä–µ–¥–Ω–∏–π –£—Ä–∞–ª", "–Æ–∂–Ω—ã–π –£—Ä–∞–ª", "–ü–æ–ª—è—Ä–Ω—ã–π –£—Ä–∞–ª"], correct: 1 },
            { level: 1, levelName: "–ù–æ–≤–∏—á–æ–∫", question: "–ö–µ–º –ø–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ –±—ã–ª –≥–ª–∞–≤–Ω—ã–π –≥–µ—Ä–æ–π —Å–∫–∞–∑–∞ ¬´–ö–∞–º–µ–Ω–Ω—ã–π —Ü–≤–µ—Ç–æ–∫¬ª?", answers: ["–ö—É–∑–Ω–µ—Ü", "–ö–∞–º–Ω–µ—Ä–µ–∑", "–®–∞—Ö—Ç—ë—Ä", "–ü–ª–æ—Ç–Ω–∏–∫"], correct: 1 },
            { level: 1, levelName: "–ù–æ–≤–∏—á–æ–∫", question: "–ö–∞–∫ –∑–≤–∞–ª–∏ –Ω–µ–≤–µ—Å—Ç—É –î–∞–Ω–∏–ª—ã-–º–∞—Å—Ç–µ—Ä–∞?", answers: ["–ù–∞—Å—Ç–µ–Ω—å–∫–∞", "–ö–∞—Ç–µ–Ω—å–∫–∞", "–ú–∞—à–µ–Ω—å–∫–∞", "–ê–ª—ë–Ω—É—à–∫–∞"], correct: 1 },
            { level: 1, levelName: "–ù–æ–≤–∏—á–æ–∫", question: "–ß—Ç–æ —Ö–æ—Ç–µ–ª —Å–æ–∑–¥–∞—Ç—å –î–∞–Ω–∏–ª–∞-–º–∞—Å—Ç–µ—Ä –∏–∑ –º–∞–ª–∞—Ö–∏—Ç–∞?", answers: ["–ö–æ—Ä–æ–Ω—É", "–ß–∞—à—É –≤ –≤–∏–¥–µ —Ü–≤–µ—Ç–∫–∞", "–®–∫–∞—Ç—É–ª–∫—É", "–ö–æ–ª–æ–Ω–Ω—É"], correct: 1 },
            
            // –£–†–û–í–ï–ù–¨ 2: –ó–ù–ê–¢–û–ö
            { level: 2, levelName: "–ó–Ω–∞—Ç–æ–∫", question: "–ö–∞–∫–æ–µ –∑–Ω–∞–º–µ–Ω–∏—Ç–æ–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Å–æ–æ—Ä—É–∂–µ–Ω–∏–µ –≤ –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–µ —É–∫—Ä–∞—à–µ–Ω–æ –∫–æ–ª–æ–Ω–Ω–∞–º–∏ –∏–∑ –≥—É–º–µ—à–µ–≤—Å–∫–æ–≥–æ –º–∞–ª–∞—Ö–∏—Ç–∞?", answers: ["–ö–∞–∑–∞–Ω—Å–∫–∏–π —Å–æ–±–æ—Ä", "–ò—Å–∞–∞–∫–∏–µ–≤—Å–∫–∏–π —Å–æ–±–æ—Ä", "–•—Ä–∞–º –°–ø–∞—Å–∞ –Ω–∞ –ö—Ä–æ–≤–∏", "–ü–µ—Ç—Ä–æ–ø–∞–≤–ª–æ–≤—Å–∫–∏–π —Å–æ–±–æ—Ä"], correct: 1 },
            { level: 2, levelName: "–ó–Ω–∞—Ç–æ–∫", question: "–ü–æ—á–µ–º—É –º–µ—Å—Ç–æ—Ä–æ–∂–¥–µ–Ω–∏–µ –ø–æ–ª—É—á–∏–ª–æ –Ω–∞–∑–≤–∞–Ω–∏–µ ¬´–ì—É–º—ë—à–∫–∏¬ª?", answers: ["–û—Ç —Ñ–∞–º–∏–ª–∏–∏ –ø–µ—Ä–≤–æ–æ—Ç–∫—Ä—ã–≤–∞—Ç–µ–ª—è", "–û—Ç —Å–ª–æ–≤–∞ ¬´–≥—É–º–Ω–æ¬ª", "–û—Ç –∑–≤—É–∫–∞ ¬´–≥—É–ª¬ª –∏–∑ —à–∞—Ö—Ç", "–ú–∞–Ω—Å–∏–π—Å–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–µ–¥–∏"], correct: 1 },
            { level: 2, levelName: "–ó–Ω–∞—Ç–æ–∫", question: "–ö–∞–∫ –≤ —Å–∫–∞–∑–∞—Ö –ë–∞–∂–æ–≤–∞ –Ω–∞–∑—ã–≤–∞–ª–∏—Å—å –ì—É–º—ë—à–∫–∏?", answers: ["–ó–æ–ª–æ—Ç–∞—è –≥–æ—Ä–∞", "–ú–µ–¥–Ω–∞—è –≥–æ—Ä–∞", "–ö–∞–º–µ–Ω–Ω—ã–π —Ü–≤–µ—Ç–æ–∫", "–ó–º–µ–∏–Ω–∞—è –≥–æ—Ä–∫–∞"], correct: 1 },
            { level: 2, levelName: "–ó–Ω–∞—Ç–æ–∫", question: "–í –∫–∞–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≥–æ—Ä–æ–¥ –ü–æ–ª–µ–≤—Å–∫–æ–π?", answers: ["–ß–µ–ª—è–±–∏–Ω—Å–∫–∞—è", "–°–≤–µ—Ä–¥–ª–æ–≤—Å–∫–∞—è", "–ü–µ—Ä–º—Å–∫–∏–π –∫—Ä–∞–π", "–¢—é–º–µ–Ω—Å–∫–∞—è"], correct: 1 },
            { level: 2, levelName: "–ó–Ω–∞—Ç–æ–∫", question: "–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–ª–∏ —Ä–∞–±–æ—á–∏—Ö, –¥–æ–±—ã–≤–∞–≤—à–∏—Ö –º–∞–ª–∞—Ö–∏—Ç –∏ –¥—Ä—É–≥–∏–µ –∫–∞–º–Ω–∏?", answers: ["–ö–∞–º–µ–Ω—â–∏–∫–∏", "–ì–æ—Ä—â–∏–∫–∏", "–†—É–¥–æ–∫–æ–ø—ã", "–°—Ç–∞—Ä–∞—Ç–µ–ª–∏"], correct: 1 },
            { level: 2, levelName: "–ó–Ω–∞—Ç–æ–∫", question: "–ö–∞–∫–æ–π –∑–∞–≤–æ–¥ –±—ã–ª –ø–æ—Å—Ç—Ä–æ–µ–Ω —Ä—è–¥–æ–º —Å –ì—É–º–µ—à–µ–≤—Å–∫–∏–º —Ä—É–¥–Ω–∏–∫–æ–º?", answers: ["–ù–µ–≤—å—è–Ω—Å–∫–∏–π –∑–∞–≤–æ–¥", "–ü–æ–ª–µ–≤—Å–∫–æ–π –º–µ–¥–µ–ø–ª–∞–≤–∏–ª—å–Ω—ã–π", "–ù–∏–∂–Ω–µ—Ç–∞–≥–∏–ª—å—Å–∫–∏–π –∑–∞–≤–æ–¥", "–°—ã—Å–µ—Ä—Ç—Å–∫–∏–π –∑–∞–≤–æ–¥"], correct: 1 },
            { level: 2, levelName: "–ó–Ω–∞—Ç–æ–∫", question: "–ö–∞–∫ –∑–≤–∞–ª–∏ –º–∞—Å—Ç–µ—Ä–∞-–∫–∞–º–Ω–µ—Ä–µ–∑–∞ –∏–∑ —Å–∫–∞–∑–∞ ¬´–ö–∞–º–µ–Ω–Ω—ã–π —Ü–≤–µ—Ç–æ–∫¬ª?", answers: ["–°—Ç–µ–ø–∞–Ω", "–î–∞–Ω–∏–ª–∞", "–ü—Ä–æ–∫–æ–ø—å–∏—á", "–ú–∏—Ç—Ä–æ—Ñ–∞–Ω"], correct: 1 },
            { level: 2, levelName: "–ó–Ω–∞—Ç–æ–∫", question: "–ö–∞–∫–æ–π —Ñ–æ—Ä–º—ã —á–∞—â–µ –≤—Å–µ–≥–æ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –ø—Ä–∏—Ä–æ–¥–Ω—ã–π –º–∞–ª–∞—Ö–∏—Ç?", answers: ["–ö—É–±–∏—á–µ—Å–∫–æ–π", "–ü–æ—á–∫–æ–≤–∏–¥–Ω–æ–π (–Ω–∞—Ç—ë—á–Ω–æ–π)", "–ü—Ä–∏–∑–º–∞—Ç–∏—á–µ—Å–∫–æ–π", "–ò–≥–æ–ª—å—á–∞—Ç–æ–π"], correct: 1 },
            { level: 2, levelName: "–ó–Ω–∞—Ç–æ–∫", question: "–ß—Ç–æ –•–æ–∑—è–π–∫–∞ –ú–µ–¥–Ω–æ–π –≥–æ—Ä—ã –ø–æ–∫–∞–∑–∞–ª–∞ –î–∞–Ω–∏–ª–µ –≤ —Å–≤–æ–∏—Ö –≤–ª–∞–¥–µ–Ω–∏—è—Ö?", answers: ["–ó–æ–ª–æ—Ç—ã–µ —Ä–æ—Å—Å—ã–ø–∏", "–ö–∞–º–µ–Ω–Ω—ã–π —Ü–≤–µ—Ç–æ–∫", "–ê–ª–º–∞–∑–Ω—ã–µ –∫–æ–ø–∏", "–°–µ—Ä–µ–±—Ä—è–Ω—ã–µ –∂–∏–ª—ã"], correct: 1 },
            { level: 2, levelName: "–ó–Ω–∞—Ç–æ–∫", question: "–ö–∞–∫–æ–µ –∂–∏–≤–æ—Ç–Ω–æ–µ —á–∞—Å—Ç–æ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–∞–ª–æ –•–æ–∑—è–π–∫—É –ú–µ–¥–Ω–æ–π –≥–æ—Ä—ã?", answers: ["–í–æ–ª–∫", "–ú–µ–¥–≤–µ–¥—å", "–Ø—â–µ—Ä–∏—Ü–∞", "–ó–º–µ—è"], correct: 2 },
            { level: 2, levelName: "–ó–Ω–∞—Ç–æ–∫", question: "–ö—Ç–æ –±—ã–ª —É—á–∏—Ç–µ–ª–µ–º –î–∞–Ω–∏–ª—ã-–º–∞—Å—Ç–µ—Ä–∞?", answers: ["–°—Ç–µ–ø–∞–Ω", "–ü—Ä–æ–∫–æ–ø—å–∏—á", "–ù–∏–∫–∏—Ç–∞", "–í–∞—Å–∏–ª–∏–π"], correct: 1 },
            { level: 2, levelName: "–ó–Ω–∞—Ç–æ–∫", question: "–ß—Ç–æ —Å–ª—É—á–∏–ª–æ—Å—å —Å –î–∞–Ω–∏–ª–æ–π –ø–æ—Å–ª–µ –≤—Å—Ç—Ä–µ—á–∏ —Å –•–æ–∑—è–π–∫–æ–π?", answers: ["–°—Ç–∞–ª –±–æ–≥–∞—Ç—ã–º", "–ò—Å—á–µ–∑ –≤ –≥–æ—Ä–µ", "–ñ–µ–Ω–∏–ª—Å—è", "–£–µ—Ö–∞–ª –≤ —Å—Ç–æ–ª–∏—Ü—É"], correct: 1 },
            
            // –£–†–û–í–ï–ù–¨ 3: –≠–ö–°–ü–ï–†–¢
            { level: 3, levelName: "–≠–∫—Å–ø–µ—Ä—Ç", question: "–ö–æ–º—É –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞–ª –ü–æ–ª–µ–≤—Å–∫–æ–π –∑–∞–≤–æ–¥ –∏ –ì—É–º–µ—à–µ–≤—Å–∫–∏–π —Ä—É–¥–Ω–∏–∫ –≤ XVIII‚ÄìXIX –≤–≤.?", answers: ["–î–µ–º–∏–¥–æ–≤—ã–º", "–°—Ç—Ä–æ–≥–∞–Ω–æ–≤—ã–º", "–¢—É—Ä—á–∞–Ω–∏–Ω–æ–≤—ã–º", "–Ø–∫–æ–≤–ª–µ–≤—ã–º"], correct: 2 },
            { level: 3, levelName: "–≠–∫—Å–ø–µ—Ä—Ç", question: "–ì–ª—ã–±–∞ –º–∞–ª–∞—Ö–∏—Ç–∞ –≤–µ—Å–æ–º 1,5 —Ç–æ–Ω–Ω—ã –∏–∑ –ì—É–º—ë—à–µ–∫ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –∫–∞–∫–æ–º –º—É–∑–µ–µ?", answers: ["–≠—Ä–º–∏—Ç–∞–∂", "–ì–æ—Ä–Ω—ã–π –º—É–∑–µ–π –°–ü–±", "–û—Ä—É–∂–µ–π–Ω–∞—è –ø–∞–ª–∞—Ç–∞", "–£—Ä–∞–ª—å—Å–∫–∏–π –≥–µ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π"], correct: 1 },
            { level: 3, levelName: "–≠–∫—Å–ø–µ—Ä—Ç", question: "–ö–∞–∫–∏–º –º–µ—Ç–æ–¥–æ–º –¥–æ–±—ã–≤–∞—é—Ç –º–µ–¥—å –Ω–∞ –ì—É–º–µ—à–µ–≤—Å–∫–æ–º –º–µ—Å—Ç–æ—Ä–æ–∂–¥–µ–Ω–∏–∏ —Å–µ–π—á–∞—Å?", answers: ["–û—Ç–∫—Ä—ã—Ç—ã–π –∫–∞—Ä—å–µ—Ä", "–î—Ä–∞–∂–Ω—ã–π —Å–ø–æ—Å–æ–±", "–ü–æ–¥–∑–µ–º–Ω–æ–µ –≤—ã—â–µ–ª–∞—á–∏–≤–∞–Ω–∏–µ", "–î–æ–±—ã—á–∞ –ø—Ä–µ–∫—Ä–∞—â–µ–Ω–∞"], correct: 2 },
            { level: 3, levelName: "–≠–∫—Å–ø–µ—Ä—Ç", question: "–í –∫–∞–∫–æ–º –≥–æ–¥—É –±—ã–ª –æ—Å–Ω–æ–≤–∞–Ω –ü–æ–ª–µ–≤—Å–∫–æ–π –º–µ–¥–µ–ø–ª–∞–≤–∏–ª—å–Ω—ã–π –∑–∞–≤–æ–¥?", answers: ["1702", "1724", "1745", "1801"], correct: 1 },
            { level: 3, levelName: "–≠–∫—Å–ø–µ—Ä—Ç", question: "–ö–∞–∫–æ–π –º–∏–Ω–µ—Ä–∞–ª —á–∞—Å—Ç–æ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å –º–∞–ª–∞—Ö–∏—Ç–æ–º –∏ –∏–º–µ–µ—Ç —Å–∏–Ω–∏–π —Ü–≤–µ—Ç?", answers: ["–õ–∞–∑—É—Ä–∏—Ç", "–ê–∑—É—Ä–∏—Ç", "–°–∞–ø—Ñ–∏—Ä", "–ê–∫–≤–∞–º–∞—Ä–∏–Ω"], correct: 1 },
            { level: 3, levelName: "–≠–∫—Å–ø–µ—Ä—Ç", question: "–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–µ—Ö–Ω–∏–∫–∞ –æ–±–ª–∏—Ü–æ–≤–∫–∏ –∏–∑–¥–µ–ª–∏–π –º–∞–ª–∞—Ö–∏—Ç–æ–º —Å –±–µ—Å—à–æ–≤–Ω—ã–º —É–∑–æ—Ä–æ–º?", answers: ["–§–ª–æ—Ä–µ–Ω—Ç–∏–π—Å–∫–∞—è –º–æ–∑–∞–∏–∫–∞", "–†—É—Å—Å–∫–∞—è –º–æ–∑–∞–∏–∫–∞", "–í–∏–∑–∞–Ω—Ç–∏–π—Å–∫–∞—è –º–æ–∑–∞–∏–∫–∞", "–†–∏–º—Å–∫–∞—è –º–æ–∑–∞–∏–∫–∞"], correct: 1 },
            { level: 3, levelName: "–≠–∫—Å–ø–µ—Ä—Ç", question: "–ö–∞–∫–æ–π —Ö–∏–º–∏—á–µ—Å–∫–∏–π —ç–ª–µ–º–µ–Ω—Ç –ø—Ä–∏–¥–∞—ë—Ç –º–∞–ª–∞—Ö–∏—Ç—É –∑–µ–ª—ë–Ω—ã–π —Ü–≤–µ—Ç?", answers: ["–ñ–µ–ª–µ–∑–æ", "–•—Ä–æ–º", "–ú–µ–¥—å", "–ù–∏–∫–µ–ª—å"], correct: 2 },
            { level: 3, levelName: "–≠–∫—Å–ø–µ—Ä—Ç", question: "–°–ª–µ–¥—ã –∫–∞–∫–æ–π –¥—Ä–µ–≤–Ω–µ–π –∫—É–ª—å—Ç—É—Ä—ã –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã –Ω–∞ –ì—É–º–µ—à–µ–≤—Å–∫–æ–º —Ä—É–¥–Ω–∏–∫–µ?", answers: ["–°–∫–∏—Ñ—Å–∫–æ–π", "–°–∞—Ä–º–∞—Ç—Å–∫–æ–π", "–ò—Ç–∫—É–ª—å—Å–∫–æ–π", "–ê–Ω–¥—Ä–æ–Ω–æ–≤—Å–∫–æ–π"], correct: 2 },
            { level: 3, levelName: "–≠–∫—Å–ø–µ—Ä—Ç", question: "–ö–∞–∫–æ–≤–∞ —Ö–∏–º–∏—á–µ—Å–∫–∞—è —Ñ–æ—Ä–º—É–ª–∞ –º–∞–ª–∞—Ö–∏—Ç–∞?", answers: ["CuSO‚ÇÑ¬∑5H‚ÇÇO", "Cu‚ÇÇCO‚ÇÉ(OH)‚ÇÇ", "CuFeS‚ÇÇ", "Cu‚ÇÇO"], correct: 1 },
            { level: 3, levelName: "–≠–∫—Å–ø–µ—Ä—Ç", question: "–ö—Ç–æ –∏–∑ —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –∏–º–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –ø–æ—Å–µ—â–∞–ª –ì—É–º–µ—à–µ–≤—Å–∫–∏–π —Ä—É–¥–Ω–∏–∫?", answers: ["–ü—ë—Ç—Ä I", "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä I", "–ù–∏–∫–æ–ª–∞–π I", "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä II"], correct: 1 },
            { level: 3, levelName: "–≠–∫—Å–ø–µ—Ä—Ç", question: "–ö–∞–∫–æ–π –≤–µ—Å –∏–º–µ–ª–∞ —Å–∞–º–∞—è –∫—Ä—É–ø–Ω–∞—è –≥–ª—ã–±–∞ –º–∞–ª–∞—Ö–∏—Ç–∞, –Ω–∞–π–¥–µ–Ω–Ω–∞—è –≤ –†–æ—Å—Å–∏–∏?", answers: ["500 –∫–≥", "1,5 —Ç–æ–Ω–Ω—ã", "3 —Ç–æ–Ω–Ω—ã", "250 —Ç–æ–Ω–Ω"], correct: 3 },
            { level: 3, levelName: "–≠–∫—Å–ø–µ—Ä—Ç", question: "–í –∫–∞–∫–æ–º –∑–∞–ª–µ –≠—Ä–º–∏—Ç–∞–∂–∞ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –º–∞–ª–∞—Ö–∏—Ç–æ–≤—ã–µ –∏–∑–¥–µ–ª–∏—è?", answers: ["–ì–µ–æ—Ä–≥–∏–µ–≤—Å–∫–∏–π –∑–∞–ª", "–ú–∞–ª–∞—Ö–∏—Ç–æ–≤—ã–π –∑–∞–ª", "–ü–∞–≤–∏–ª—å–æ–Ω–Ω—ã–π –∑–∞–ª", "–ì–µ—Ä–±–æ–≤—ã–π –∑–∞–ª"], correct: 1 },
        ];

        // ============ –ò–ì–†–û–í–û–ï –°–û–°–¢–û–Ø–ù–ò–ï ============
        const boardSize = 50;
        let players = [];
        let currentPlayer = 0;
        let isRolling = false;
        let currentQuestion = null;
        let usedQuestions = [[], []];

        const questionCells = [];
        const bonusCells = [9, 19, 29, 39];
        const penaltyCells = [14, 24, 34, 44];

        for (let i = 2; i < boardSize - 1; i += 2) {
            if (!bonusCells.includes(i) && !penaltyCells.includes(i)) {
                questionCells.push(i);
            }
        }

        function getLevelForCell(cellIndex) {
            if (cellIndex <= 16) return 1;
            if (cellIndex <= 33) return 2;
            return 3;
        }

        function getLevelColor(level) {
            switch(level) {
                case 1: return 'bg-blue-600';
                case 2: return 'bg-yellow-600';
                case 3: return 'bg-red-600';
                default: return 'bg-gray-600';
            }
        }
        
        function getLevelCellClass(level) {
            switch(level) {
                case 1: return 'question-cell-1';
                case 2: return 'question-cell-2';
                case 3: return 'question-cell-3';
                default: return 'question-cell-1';
            }
        }

        // ============ –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ò–ì–†–´ ============
        function initGame() {
            players = [
                { position: 0, correct: 0, wrong: 0, icon: selectedTool1.icon, name: '–ò–≥—Ä–æ–∫ 1', toolName: selectedTool1.name },
                { position: 0, correct: 0, wrong: 0, icon: selectedTool2.icon, name: '–ò–≥—Ä–æ–∫ 2', toolName: selectedTool2.name }
            ];
            currentPlayer = 0;
            usedQuestions = [[], []];
            isRolling = false;
            document.getElementById('rollDice').disabled = false;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –∏–≥—Ä–æ–∫–æ–≤
            document.getElementById('p1Icon').textContent = players[0].icon;
            document.getElementById('p1CardName').textContent = players[0].name;
            document.getElementById('p1CardTool').textContent = players[0].toolName;
            
            document.getElementById('p2Icon').textContent = players[1].icon;
            document.getElementById('p2CardName').textContent = players[1].name;
            document.getElementById('p2CardTool').textContent = players[1].toolName;
            
            updateStats();
            updateTurnIndicator();
            renderBoard();
        }

        function renderBoard() {
            const board = document.getElementById('gameBoard');
            board.innerHTML = '';

            for (let i = 0; i < boardSize; i++) {
                const cell = document.createElement('div');
                cell.className = 'cell relative h-10 md:h-12 rounded-lg flex items-center justify-center text-white font-bold shadow-md border';
                
                if (i === 0) {
                    cell.classList.add('bg-gradient-to-br', 'from-amber-500', 'to-yellow-600', 'border-amber-400');
                    cell.innerHTML = '<span class="text-sm">üè†</span>';
                } else if (i === boardSize - 1) {
                    cell.classList.add('bg-gradient-to-br', 'from-purple-500', 'to-pink-600', 'border-purple-400');
                    cell.innerHTML = '<span class="text-sm">üëë</span>';
                } else if (bonusCells.includes(i)) {
                    cell.classList.add('bonus-cell', 'border-green-400');
                    cell.innerHTML = `<div class="text-center"><span class="text-sm">üçÄ</span><div class="text-xs">+3</div></div>`;
                } else if (penaltyCells.includes(i)) {
                    cell.classList.add('penalty-cell', 'border-purple-400');
                    cell.innerHTML = `<div class="text-center"><span class="text-sm">üï≥Ô∏è</span><div class="text-xs">-3</div></div>`;
                } else if (questionCells.includes(i)) {
                    const level = getLevelForCell(i);
                    cell.classList.add(getLevelCellClass(level), 'border-white/30');
                    cell.innerHTML = `<div class="text-center"><span class="text-xs">üíé</span><div class="text-xs opacity-70">${i + 1}</div></div>`;
                } else {
                    cell.classList.add('bg-gradient-to-br', 'from-gray-700', 'to-gray-800', 'border-gray-600');
                    cell.innerHTML = `<span class="text-gray-400 text-xs">${i + 1}</span>`;
                }

                players.forEach((player, idx) => {
                    if (i === player.position) {
                        const playerMarker = document.createElement('div');
                        playerMarker.className = `player player-${idx + 1}`;
                        playerMarker.innerHTML = player.icon;
                        cell.appendChild(playerMarker);
                    }
                });

                board.appendChild(cell);
            }
        }

        function updateStats() {
            document.getElementById('player1Position').textContent = players[0].position + 1;
            document.getElementById('player1Correct').textContent = players[0].correct;
            document.getElementById('player1Wrong').textContent = players[0].wrong;
            
            document.getElementById('player2Position').textContent = players[1].position + 1;
            document.getElementById('player2Correct').textContent = players[1].correct;
            document.getElementById('player2Wrong').textContent = players[1].wrong;
        }

        function updateTurnIndicator() {
            const indicator = document.getElementById('turnIndicator');
            const card1 = document.getElementById('player1Card');
            const card2 = document.getElementById('player2Card');
            
            if (currentPlayer === 0) {
                indicator.className = 'bg-amber-500 text-gray-900 px-4 py-1 rounded-full font-bold text-sm';
                indicator.innerHTML = `${players[0].icon} –•–æ–¥ –∏–≥—Ä–æ–∫–∞ 1 (${players[0].toolName})`;
                card1.classList.add('active-player');
                card1.classList.remove('opacity-60');
                card2.classList.remove('active-player');
                card2.classList.add('opacity-60');
            } else {
                indicator.className = 'bg-cyan-500 text-gray-900 px-4 py-1 rounded-full font-bold text-sm';
                indicator.innerHTML = `${players[1].icon} –•–æ–¥ –∏–≥—Ä–æ–∫–∞ 2 (${players[1].toolName})`;
                card2.classList.add('active-player');
                card2.classList.remove('opacity-60');
                card1.classList.remove('active-player');
                card1.classList.add('opacity-60');
            }
        }

        function rollDice() {
            if (isRolling) return;
            isRolling = true;

            const diceBtn = document.getElementById('rollDice');
            diceBtn.classList.add('rolling');
            diceBtn.disabled = true;

            const diceResult = document.getElementById('diceResult');
            const diceValue = document.getElementById('diceValue');

            let rolls = 0;
            const rollInterval = setInterval(() => {
                diceValue.textContent = Math.floor(Math.random() * 6) + 1;
                rolls++;
                if (rolls > 10) {
                    clearInterval(rollInterval);
                    const finalValue = Math.floor(Math.random() * 6) + 1;
                    diceValue.textContent = finalValue;
                    diceResult.classList.remove('hidden');
                    diceBtn.classList.remove('rolling');
                    
                    movePlayer(finalValue);
                }
            }, 100);
        }

        function movePlayer(steps) {
            const player = players[currentPlayer];
            const targetPosition = Math.min(player.position + steps, boardSize - 1);
            
            const moveInterval = setInterval(() => {
                if (player.position < targetPosition) {
                    player.position++;
                    renderBoard();
                    updateStats();
                } else {
                    clearInterval(moveInterval);
                    checkCell();
                }
            }, 150);
        }

        function checkCell() {
            const player = players[currentPlayer];
            const pos = player.position;

            if (pos >= boardSize - 1) {
                setTimeout(() => showWinModal(), 500);
            } else if (questionCells.includes(pos)) {
                setTimeout(() => showQuestion(), 400);
            } else if (bonusCells.includes(pos)) {
                setTimeout(() => showBonusModal(true), 400);
            } else if (penaltyCells.includes(pos)) {
                setTimeout(() => showBonusModal(false), 400);
            } else {
                endTurn();
            }
        }

        function showBonusModal(isBonus) {
            const modal = document.getElementById('bonusModal');
            const content = document.getElementById('bonusModalContent');
            const icon = document.getElementById('bonusIcon');
            const title = document.getElementById('bonusTitle');
            const text = document.getElementById('bonusText');

            if (isBonus) {
                content.className = 'bg-gradient-to-br from-green-700 to-emerald-900 rounded-2xl p-5 max-w-sm w-full shadow-2xl text-center border-2 border-green-400';
                icon.textContent = 'üçÄ';
                title.textContent = '–£–¥–∞—á–∞!';
                text.textContent = `${players[currentPlayer].icon} ${players[currentPlayer].toolName} –Ω–∞—à–ª–∞ —Å–∞–º–æ—Ü–≤–µ—Ç! +3 –∫–ª–µ—Ç–∫–∏ –≤–ø–µ—Ä—ë–¥!`;
            } else {
                content.className = 'bg-gradient-to-br from-purple-700 to-violet-900 rounded-2xl p-5 max-w-sm w-full shadow-2xl text-center border-2 border-purple-400';
                icon.textContent = 'üï≥Ô∏è';
                title.textContent = '–õ–æ–≤—É—à–∫–∞!';
                text.textContent = `${players[currentPlayer].icon} ${players[currentPlayer].toolName} –ø—Ä–æ–≤–∞–ª–∏–ª–∞—Å—å –≤ —Å—Ç–∞—Ä—É—é —à–∞—Ö—Ç—É! -3 –∫–ª–µ—Ç–∫–∏ –Ω–∞–∑–∞–¥!`;
            }

            modal.classList.remove('hidden');
            modal.classList.add('flex');

            setTimeout(() => {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
                
                if (isBonus) {
                    applyBonus(3);
                } else {
                    applyPenalty(3);
                }
            }, 1500);
        }

        function applyBonus(steps) {
            const player = players[currentPlayer];
            const targetPosition = Math.min(player.position + steps, boardSize - 1);
            
            const moveInterval = setInterval(() => {
                if (player.position < targetPosition) {
                    player.position++;
                    renderBoard();
                    updateStats();
                } else {
                    clearInterval(moveInterval);
                    if (player.position >= boardSize - 1) {
                        setTimeout(() => showWinModal(), 500);
                    } else {
                        endTurn();
                    }
                }
            }, 150);
        }

        function applyPenalty(steps) {
            const player = players[currentPlayer];
            const targetPosition = Math.max(player.position - steps, 0);
            
            const moveInterval = setInterval(() => {
                if (player.position > targetPosition) {
                    player.position--;
                    renderBoard();
                    updateStats();
                } else {
                    clearInterval(moveInterval);
                    endTurn();
                }
            }, 150);
        }

        function getQuestionForPosition() {
            const level = getLevelForCell(players[currentPlayer].position);
            const playerUsed = usedQuestions[currentPlayer];
            
            const availableQuestions = questions.filter((q, idx) => 
                q.level === level && !playerUsed.includes(idx)
            );
            
            if (availableQuestions.length === 0) {
                usedQuestions[currentPlayer] = playerUsed.filter(idx => questions[idx].level !== level);
                const levelQuestions = questions.filter(q => q.level === level);
                return levelQuestions[Math.floor(Math.random() * levelQuestions.length)];
            }
            
            const selected = availableQuestions[Math.floor(Math.random() * availableQuestions.length)];
            usedQuestions[currentPlayer].push(questions.indexOf(selected));
            return selected;
        }

        function showQuestion() {
            currentQuestion = getQuestionForPosition();
            const player = players[currentPlayer];

            document.getElementById('currentPlayerBadge').textContent = `${player.icon} ${player.name}`;
            document.getElementById('currentPlayerBadge').className = `level-badge ${currentPlayer === 0 ? 'bg-amber-600' : 'bg-cyan-600'} text-white`;
            document.getElementById('levelBadge').textContent = currentQuestion.levelName;
            document.getElementById('levelBadge').className = `level-badge ${getLevelColor(currentQuestion.level)} text-white`;
            document.getElementById('questionText').textContent = currentQuestion.question;

            const answersContainer = document.getElementById('answersContainer');
            answersContainer.innerHTML = '';

            const shuffledAnswers = currentQuestion.answers.map((answer, index) => ({
                text: answer,
                isCorrect: index === currentQuestion.correct
            }));
            
            for (let i = shuffledAnswers.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffledAnswers[i], shuffledAnswers[j]] = [shuffledAnswers[j], shuffledAnswers[i]];
            }

            const letters = ['–ê', '–ë', '–í', '–ì'];
            shuffledAnswers.forEach((answer, index) => {
                const btn = document.createElement('button');
                btn.className = 'w-full py-2 px-3 bg-gray-800 hover:bg-emerald-800 text-white rounded-lg transition text-left border border-gray-600 hover:border-emerald-500 text-sm';
                btn.innerHTML = `<span class="text-emerald-400 font-bold">${letters[index]})</span> ${answer.text}`;
                btn.onclick = () => checkAnswer(answer.isCorrect, btn);
                answersContainer.appendChild(btn);
            });

            document.getElementById('resultMessage').classList.add('hidden');
            document.getElementById('questionModal').classList.remove('hidden');
            document.getElementById('questionModal').classList.add('flex');
        }

        function checkAnswer(isCorrect, button) {
            const buttons = document.querySelectorAll('#answersContainer button');
            buttons.forEach(btn => btn.disabled = true);

            const resultMessage = document.getElementById('resultMessage');
            resultMessage.classList.remove('hidden');

            const correctAnswerText = currentQuestion.answers[currentQuestion.correct];
            const player = players[currentPlayer];

            if (isCorrect) {
                player.correct++;
                button.classList.remove('bg-gray-800', 'border-gray-600');
                button.classList.add('bg-green-600', 'border-green-400');
                resultMessage.className = 'mt-3 p-2 rounded-xl text-center text-sm font-bold bg-green-700 text-white border border-green-500';
                resultMessage.innerHTML = '‚úÖ –í–µ—Ä–Ω–æ! +2 –∫–ª–µ—Ç–∫–∏ –≤–ø–µ—Ä—ë–¥';
                
                setTimeout(() => {
                    closeQuestionModal();
                    applyBonus(2);
                }, 1500);
            } else {
                player.wrong++;
                button.classList.remove('bg-gray-800', 'border-gray-600');
                button.classList.add('bg-red-600', 'border-red-400');
                
                buttons.forEach(btn => {
                    if (btn.textContent.includes(correctAnswerText)) {
                        btn.classList.remove('bg-gray-800', 'border-gray-600');
                        btn.classList.add('bg-green-600', 'border-green-400');
                    }
                });
                
                resultMessage.className = 'mt-3 p-2 rounded-xl text-center text-sm font-bold bg-red-700 text-white border border-red-500';
                resultMessage.innerHTML = `‚ùå –ù–µ–≤–µ—Ä–Ω–æ! –ü—Ä–∞–≤–∏–ª—å–Ω–æ: ${correctAnswerText}<br>-2 –∫–ª–µ—Ç–∫–∏ –Ω–∞–∑–∞–¥`;
                
                setTimeout(() => {
                    closeQuestionModal();
                    applyPenalty(2);
                }, 2000);
            }

            updateStats();
        }

        function closeQuestionModal() {
            document.getElementById('questionModal').classList.add('hidden');
            document.getElementById('questionModal').classList.remove('flex');
        }

        function endTurn() {
            currentPlayer = currentPlayer === 0 ? 1 : 0;
            updateTurnIndicator();
            isRolling = false;
            document.getElementById('rollDice').disabled = false;
        }

        function showWinModal() {
            const winner = players[currentPlayer];
            document.getElementById('winnerText').textContent = `${winner.icon} ${winner.name} (${winner.toolName}) –¥–æ–±—Ä–∞–ª—Å—è –¥–æ –ø–∞–ª–∞—Ç –•–æ–∑—è–π–∫–∏!`;
            document.getElementById('finalP1Label').innerHTML = `${players[0].icon} –ò–≥—Ä–æ–∫ 1 (${players[0].toolName})`;
            document.getElementById('finalP2Label').innerHTML = `${players[1].icon} –ò–≥—Ä–æ–∫ 2 (${players[1].toolName})`;
            document.getElementById('final1Correct').textContent = players[0].correct;
            document.getElementById('final1Wrong').textContent = players[0].wrong;
            document.getElementById('final2Correct').textContent = players[1].correct;
            document.getElementById('final2Wrong').textContent = players[1].wrong;
            
            document.getElementById('winModal').classList.remove('hidden');
            document.getElementById('winModal').classList.add('flex');
        }

        function goToSelection() {
            document.getElementById('diceResult').classList.add('hidden');
            document.getElementById('winModal').classList.add('hidden');
            document.getElementById('winModal').classList.remove('flex');
            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('selectionScreen').classList.remove('hidden');
            
            // –°–±—Ä–æ—Å–∏—Ç—å –≤—ã–±–æ—Ä
            selectedTool1 = null;
            selectedTool2 = null;
            document.getElementById('preview1').textContent = '‚ùì';
            document.getElementById('preview1Name').textContent = '–ù–µ –≤—ã–±—Ä–∞–Ω–æ';
            document.getElementById('preview1Name').className = 'text-gray-400 text-xs mt-1';
            document.getElementById('preview2').textContent = '‚ùì';
            document.getElementById('preview2Name').textContent = '–ù–µ –≤—ã–±—Ä–∞–Ω–æ';
            document.getElementById('preview2Name').className = 'text-gray-400 text-xs mt-1';
            
            document.getElementById('selectionStep1').classList.remove('hidden');
            document.getElementById('selectionStep2').classList.add('hidden');
            document.getElementById('step1Dot').className = 'step-indicator active w-8 h-8 rounded-full bg-amber-400 text-black flex items-center justify-center font-bold text-sm';
            document.getElementById('step1Dot').textContent = '1';
            document.getElementById('step2Dot').className = 'step-indicator w-8 h-8 rounded-full bg-gray-600 text-gray-300 flex items-center justify-center font-bold text-sm';
            
            const btn1 = document.getElementById('confirmPlayer1');
            btn1.disabled = true;
            btn1.className = 'bg-gray-600 text-gray-400 font-bold py-2.5 px-8 rounded-xl text-base cursor-not-allowed transition border-2 border-gray-500';
            const btn2 = document.getElementById('startGameBtn');
            btn2.disabled = true;
            btn2.className = 'bg-gray-600 text-gray-400 font-bold py-2.5 px-8 rounded-xl text-base cursor-not-allowed transition border-2 border-gray-500';
            
            renderToolCards('toolsGrid1', 1);
        }

        // ============ –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô ============
        document.getElementById('rollDice').addEventListener('click', rollDice);
        
        document.getElementById('restartGame').addEventListener('click', goToSelection);
        document.getElementById('playAgain').addEventListener('click', goToSelection);
    </script>
</body>
</html>
